

<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="">
    
    
      
        <title>Warp Pipe usage examples - Warp Pipe</title>
      
    
    
      
        
        
      
      

    
    
    
      
        
        
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
        <link rel="stylesheet" type="text/css" href="_static/sphinx_immaterial_theme.af531f03affe68837.min.css?v=2410bb73" />
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="deep-orange">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="Warp Pipe" class="md-header__button md-logo" aria-label="Warp Pipe" data-md-component="logo">
      <img src="_static/white.svg" alt="logo">
    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Warp Pipe
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Warp Pipe usage examples
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="deep-orange"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="deep-orange"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
            </label>
          
        
      </form>
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="Warp Pipe" class="md-nav__button md-logo" aria-label="Warp Pipe" data-md-component="logo">
      <img src="_static/white.svg" alt="logo">
    </a>
    Warp Pipe
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="introduction.html" class="md-nav__link">
        <span class="md-ellipsis">Introduction</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="pcie.html" class="md-nav__link">
        <span class="md-ellipsis">PCI Express</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="basics.html" class="md-nav__link">
        <span class="md-ellipsis">Basic Warp Pipe usage</span>
      </a>
    </li>
  

    
      
      
      

  
  
    
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          <span class="md-ellipsis">Warp Pipe usage examples</span>
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="#" class="md-nav__link md-nav__link--active">
        <span class="md-ellipsis">Warp Pipe usage examples</span>
      </a>
      
        

<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#memory-mock" class="md-nav__link">
    <span title="memory-mock (reference label)" class="md-ellipsis">Memory mock</span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pcie-pipe" class="md-nav__link">
    <span class="md-ellipsis">PCIe Pipe</span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pcie-native" class="md-nav__link">
    <span class="md-ellipsis">PCIe Native</span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pcie-native-threaded" class="md-nav__link">
    <span class="md-ellipsis">PCIe Native <wbr>(threaded)</span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pcie-dma" class="md-nav__link">
    <span class="md-ellipsis">PCIe DMA</span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="library.html" class="md-nav__link">
        <span class="md-ellipsis">Using the library</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="qemu.html" class="md-nav__link">
        <span class="md-ellipsis">QEMU</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="wireshark.html" class="md-nav__link">
        <span class="md-ellipsis">Wireshark</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="twister.html" class="md-nav__link">
        <span class="md-ellipsis">Testing with Twister</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="performance_analysis.html" class="md-nav__link">
        <span class="md-ellipsis">Warp Pipe performance analysis</span>
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset" role="main">
                  


<h1 id="warp-pipe-usage-examples">Warp Pipe usage examples<a class="headerlink" href="#warp-pipe-usage-examples" title="Link to this heading">¶</a></h1>
<p>Warp Pipe can be used in various different contexts:</p>
<ul class="simple">
<li><p>directly with host applications, mocking PCIe devices</p></li>
<li><p>linked with operating systems like Zephyr</p></li>
<li><p>connected to simulation tools, intercepting PCIe traffic</p></li>
</ul>
<p>Typical target usage will consist of two operating systems, running in virtualized/simulated environments, communicating over Warp Pipe running on host, as can be exemplified by the following graphs:</p>
<p><img alt="Warp Pipe Basic Flow" src="_images/warp-pipe--basic-flow.svg" /></p>
<p>Apart from employing Warp Pipe for node-to-node communication, it can also be used to automate testing of APIs and protocols over PCIe, with one endpoint running in a simulated environment and the other one in a custom application on host, prepared specifically for the purpose of the test and exercising a desired test scenario.</p>
<p>These tests can also be orchestrated via Zephyr’s Twister and a custom Warp Pipe harness:</p>
<p><img alt="Warp Pipe Basic Flow" src="_images/warp-pipe--testing-flow.svg" /></p>
<p>To exemplify these various use cases, the Warp Pipe repository comes with a range of samples and tests.</p>
<h2 id="memory-mock"><span id="id1"></span>Memory mock<a class="headerlink" href="#memory-mock" title="Link to this heading">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">memory-mock</span></code> application uses <code class="docutils literal notranslate"><span class="pre">warp-pipe</span></code> library and acts as simple PCIe device that emulates memory.</p>
<p>It’s used as an endpoint for several tests and in itself is a good example of the warp-pipe API usage.</p>
<p>Before building, ensure that <code class="docutils literal notranslate"><span class="pre">warp-pipe</span></code> <a class="reference internal" href="basics.html"><span class="doc std std-doc">is properly installed and accessible</span></a> and that the <code class="docutils literal notranslate"><span class="pre">PKG_CONFIG_PATH</span></code> variable is set if needed.</p>
<p>To build <code class="docutils literal notranslate"><span class="pre">memory-mock</span></code>, run the following commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><code>mkdir -p build_memory_mock
cmake -S memory-mock -B build_memory_mock
make -j $(nproc) -C build_memory_mock
</code></pre></div>
</div>
<p>To launch the <code class="docutils literal notranslate"><span class="pre">memory-mock</span></code>, use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><code><span class="o">./</span><span class="n">build_memory_mock</span><span class="o">/</span><span class="n">memory_mock</span>
</code></pre></div>
</div>
<p>Keep in mind that Twister tests expect <code class="docutils literal notranslate"><span class="pre">memory-mock</span></code> to be accessible in the aforementioned directory.</p>
<h2 id="pcie-pipe">PCIe Pipe<a class="headerlink" href="#pcie-pipe" title="Link to this heading">¶</a></h2>
<p>Requirements:</p>
<ul class="simple">
<li><p><a class="reference internal" href="basics.html"><span class="doc std std-doc">warp-pipe</span></a></p></li>
<li><p><a class="reference internal" href="qemu.html"><span class="doc std std-doc">QEMU</span></a></p></li>
<li><p><a class="reference internal" href="twister.html#zephyr-setup"><span class="std std-ref">Zephyr</span></a></p></li>
</ul>
<p>This sample is located in <code class="docutils literal notranslate"><span class="pre">zephyr-samples/pcie-pipe</span></code> and allows you to connect two Zephyr instances, one working as a server, one as a client. It relies on the QEMU <code class="docutils literal notranslate"><span class="pre">warp-pipe</span></code> device to handle communication between two nodes.</p>
<p>You need to build the sample in two configurations:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><code><span class="n">west</span> <span class="n">build</span> <span class="o">-</span><span class="n">d</span> <span class="n">build</span><span class="o">.</span><span class="n">pcie_pipe_server</span><span class="o">/</span> <span class="o">-</span><span class="n">b</span> <span class="n">qemu_x86_64</span> <span class="n">zephyr</span><span class="o">-</span><span class="n">samples</span><span class="o">/</span><span class="n">pcie_pipe</span><span class="o">/</span> <span class="o">--</span> <span class="o">-</span><span class="n">DWarpPipeConnection</span><span class="o">=</span><span class="n">listen</span>
<span class="n">west</span> <span class="n">build</span> <span class="o">-</span><span class="n">d</span> <span class="n">build</span><span class="o">.</span><span class="n">pcie_pipe_client</span><span class="o">/</span> <span class="o">-</span><span class="n">b</span> <span class="n">qemu_x86_64</span> <span class="n">zephyr</span><span class="o">-</span><span class="n">samples</span><span class="o">/</span><span class="n">pcie_pipe</span><span class="o">/</span> <span class="o">--</span> <span class="o">-</span><span class="n">DWarpPipeConnection</span><span class="o">=</span><span class="n">connect</span>
</code></pre></div>
</div>
<p>After building, run the two targets in separate windows for clarity.</p>
<p>First, start the server:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><code><span class="n">west</span> <span class="n">build</span> <span class="o">-</span><span class="n">t</span> <span class="n">run</span> <span class="o">-</span><span class="n">d</span> <span class="n">build</span><span class="o">.</span><span class="n">pcie_pipe_server</span><span class="o">/</span>
</code></pre></div>
</div>
<p>Then, spawn the client:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><code><span class="n">west</span> <span class="n">build</span> <span class="o">-</span><span class="n">t</span> <span class="n">run</span> <span class="o">-</span><span class="n">d</span> <span class="n">build</span><span class="o">.</span><span class="n">pcie_pipe_client</span><span class="o">/</span>
</code></pre></div>
</div>
<p>The client will generate the following output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><code>Initial memory values:
0x3020100 0x7060504 0xb0a0908 0xf0e0d0c 0x13121110 0x17161514 0x1b1a1918 0x1f1e1d1c
0x23222120 0x27262524 0x2b2a2928 0x2f2e2d2c 0x33323130 0x37363534 0x3b3a3938 0x3f3e3d3c
0x43424140 0x47464544 0x4b4a4948 0x4f4e4d4c 0x53525150 0x57565554 0x5b5a5958 0x5f5e5d5c
0x63626160 0x67666564 0x6b6a6968 0x6f6e6d6c 0x73727170 0x77767574 0x7b7a7978 0x7f7e7d7c
Updated memory values:
0xabababab 0xabababab 0xabababab 0xabababab 0xabababab 0xabababab 0xabababab 0xabababab
0xabababab 0xabababab 0xabababab 0xabababab 0xabababab 0xabababab 0xabababab 0xabababab
0xabababab 0xabababab 0xabababab 0xabababab 0xabababab 0xabababab 0xabababab 0xabababab
0xabababab 0xabababab 0xabababab 0xabababab 0xabababab 0xabababab 0xabababab 0xabababab
Allocated 1 vectors
1 MSI-X Vectors connected
Received MSI-X IRQ!
Received MSI-X IRQ!
</code></pre></div>
</div>
<p>Stop both samples with <code class="docutils literal notranslate"><span class="pre">Ctrl-C</span></code>.</p>
<h2 id="pcie-native">PCIe Native<a class="headerlink" href="#pcie-native" title="Link to this heading">¶</a></h2>
<p>Requirements</p>
<ul class="simple">
<li><p><a class="reference internal" href="basics.html"><span class="doc std std-doc">warp-pipe</span></a></p></li>
<li><p><a class="reference internal" href="#memory-mock">memory-mock</a></p></li>
<li><p><a class="reference internal" href="twister.html#zephyr-setup"><span class="std std-ref">Zephyr</span></a></p></li>
</ul>
<p>This sample, located in <code class="docutils literal notranslate"><span class="pre">zephyr-samples/pcie_native</span></code>, presents communication between <code class="docutils literal notranslate"><span class="pre">memory-mock</span></code> and Zephyr compiled for the <code class="docutils literal notranslate"><span class="pre">native_sim</span></code> target.</p>
<p>First, build Zephyr:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><code><span class="n">west</span> <span class="n">build</span> <span class="o">-</span><span class="n">p</span> <span class="o">-</span><span class="n">d</span> <span class="n">build</span><span class="o">.</span><span class="n">pcie_native</span> <span class="o">-</span><span class="n">b</span> <span class="n">native_sim</span> <span class="n">zephyr</span><span class="o">-</span><span class="n">samples</span><span class="o">/</span><span class="n">pcie_native</span>
</code></pre></div>
</div>
<p>After that, launch <code class="docutils literal notranslate"><span class="pre">memory-mock</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><code><span class="o">./</span><span class="n">build_memory_mock</span><span class="o">/</span><span class="n">memory_mock</span>
</code></pre></div>
</div>
<p>As the last step, launch Zephyr:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><code><span class="o">./</span><span class="n">build</span><span class="o">.</span><span class="n">pcie_native</span><span class="o">/</span><span class="n">zephyr</span><span class="o">/</span><span class="n">zephyr</span><span class="o">.</span><span class="n">exe</span>
</code></pre></div>
</div>
<p>Expect the following output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><code><span class="o">***</span> <span class="n">Booting</span> <span class="n">Zephyr</span> <span class="n">OS</span> <span class="n">build</span> <span class="n">f89c5ddd1aaf</span> <span class="o">***</span>
<span class="p">[</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.000</span><span class="p">,</span><span class="mi">000</span><span class="p">]</span> <span class="o">&lt;</span><span class="n">inf</span><span class="o">&gt;</span> <span class="n">pcie_native</span><span class="p">:</span> <span class="n">Started</span> <span class="n">app</span>
<span class="p">[</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.000</span><span class="p">,</span><span class="mi">000</span><span class="p">]</span> <span class="o">&lt;</span><span class="n">inf</span><span class="o">&gt;</span> <span class="n">pcie_native</span><span class="p">:</span> <span class="n">Started</span> <span class="n">client</span>
<span class="p">[</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.000</span><span class="p">,</span><span class="mi">000</span><span class="p">]</span> <span class="o">&lt;</span><span class="n">inf</span><span class="o">&gt;</span> <span class="n">pcie_native</span><span class="p">:</span> <span class="n">Registering</span> <span class="n">bar</span> <span class="mi">0</span> <span class="n">at</span> <span class="mh">0x100000</span> <span class="p">(</span><span class="n">size</span><span class="p">:</span> <span class="mi">128</span><span class="p">)</span>
<span class="p">[</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.000</span><span class="p">,</span><span class="mi">000</span><span class="p">]</span> <span class="o">&lt;</span><span class="n">inf</span><span class="o">&gt;</span> <span class="n">pcie_native</span><span class="p">:</span> <span class="n">Registering</span> <span class="n">bar</span> <span class="mi">1</span> <span class="n">at</span> <span class="mh">0x140000</span> <span class="p">(</span><span class="n">size</span><span class="p">:</span> <span class="mi">1024</span><span class="p">)</span>
<span class="n">Read</span> <span class="n">data</span> <span class="p">(</span><span class="nb">len</span><span class="p">:</span> <span class="mi">16</span><span class="p">):</span> <span class="mi">10</span> <span class="mi">11</span> <span class="mi">12</span> <span class="mi">13</span> <span class="mi">14</span> <span class="mi">15</span> <span class="mi">16</span> <span class="mi">17</span> <span class="mi">18</span> <span class="mi">19</span> <span class="mi">1</span><span class="n">a</span> <span class="mi">1</span><span class="n">b</span> <span class="mi">1</span><span class="n">c</span> <span class="mi">1</span><span class="n">d</span> <span class="mi">1</span><span class="n">e</span> <span class="mi">1</span><span class="n">f</span>
<span class="n">Read</span> <span class="n">data</span> <span class="p">(</span><span class="nb">len</span><span class="p">:</span> <span class="mi">16</span><span class="p">):</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span>
<span class="n">Read</span> <span class="n">data</span> <span class="p">(</span><span class="nb">len</span><span class="p">:</span> <span class="mi">16</span><span class="p">):</span> <span class="mi">68</span> <span class="mi">65</span> <span class="mi">6</span><span class="n">c</span> <span class="mi">6</span><span class="n">c</span> <span class="mi">6</span><span class="n">f</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span> <span class="mi">00</span>
<span class="p">[</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.000</span><span class="p">,</span><span class="mi">000</span><span class="p">]</span> <span class="o">&lt;</span><span class="n">inf</span><span class="o">&gt;</span> <span class="n">pcie_native</span><span class="p">:</span> <span class="n">The</span> <span class="nb">next</span> <span class="n">read</span> <span class="n">should</span> <span class="n">fail</span>
<span class="p">[</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.000</span><span class="p">,</span><span class="mi">000</span><span class="p">]</span> <span class="o">&lt;</span><span class="n">err</span><span class="o">&gt;</span> <span class="n">pcie_native</span><span class="p">:</span> <span class="n">Failed</span> <span class="n">to</span> <span class="n">read</span> <span class="n">bar</span> <span class="mi">2</span> <span class="n">at</span> <span class="n">addr</span> <span class="mi">0</span><span class="o">-</span><span class="mi">0</span>
<span class="p">[</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.000</span><span class="p">,</span><span class="mi">000</span><span class="p">]</span> <span class="o">&lt;</span><span class="n">inf</span><span class="o">&gt;</span> <span class="n">pcie_native</span><span class="p">:</span> <span class="n">All</span> <span class="n">checks</span> <span class="n">has</span> <span class="n">succeded</span><span class="o">.</span>
</code></pre></div>
</div>
<h2 id="pcie-native-threaded">PCIe Native (threaded)<a class="headerlink" href="#pcie-native-threaded" title="Link to this heading">¶</a></h2>
<p>Requirements</p>
<ul class="simple">
<li><p><a class="reference internal" href="basics.html"><span class="doc std std-doc">warp-pipe</span></a></p></li>
<li><p><a class="reference internal" href="#memory-mock">memory-mock</a></p></li>
<li><p><a class="reference internal" href="twister.html#zephyr-setup"><span class="std std-ref">Zephyr</span></a></p></li>
</ul>
<p>This sample, located in <code class="docutils literal notranslate"><span class="pre">zephyr-samples/pcie_native_thread</span></code>, is a threaded version of PCIe Native, used for benchmarking Warp Pipe.</p>
<p>First, build Zephyr:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><code><span class="n">west</span> <span class="n">build</span> <span class="o">-</span><span class="n">p</span> <span class="o">-</span><span class="n">d</span> <span class="n">build</span><span class="o">.</span><span class="n">pcie_native_thread</span> <span class="o">-</span><span class="n">b</span> <span class="n">native_sim</span> <span class="n">zephyr</span><span class="o">-</span><span class="n">samples</span><span class="o">/</span><span class="n">pcie_native_thread</span>
</code></pre></div>
</div>
<p>After that, launch <code class="docutils literal notranslate"><span class="pre">memory-mock</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><code><span class="o">./</span><span class="n">build_memory_mock</span><span class="o">/</span><span class="n">memory_mock</span>
</code></pre></div>
</div>
<p>As the last step, launch Zephyr:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><code><span class="o">./</span><span class="n">build</span><span class="o">.</span><span class="n">pcie_native_thread</span><span class="o">/</span><span class="n">zephyr</span><span class="o">/</span><span class="n">zephyr</span><span class="o">.</span><span class="n">exe</span>
</code></pre></div>
</div>
<p>Expect the following output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><code>*** Booting Zephyr OS build f89c5ddd1aaf ***
[00:00:00.000,000] &lt;inf&gt; pcie_native: Started app
[00:00:00.000,000] &lt;inf&gt; pcie_native: Started client
[00:00:00.000,000] &lt;inf&gt; pcie_native: Registering bar 0 at 0x100000 (size: 128)
[00:00:00.000,000] &lt;inf&gt; pcie_native: Registering bar 1 at 0x140000 (size: 2048)
[00:00:21.000,000] &lt;inf&gt; pcie_native: Done!
</code></pre></div>
</div>
<p>To read more about using the application for benchmarking, see the <a class="reference internal" href="performance_analysis.html"><span class="doc std std-doc">performance analysis chapter</span></a></p>
<h2 id="pcie-dma">PCIe DMA<a class="headerlink" href="#pcie-dma" title="Link to this heading">¶</a></h2>
<p>Requirements:</p>
<ul class="simple">
<li><p><a class="reference internal" href="basics.html"><span class="doc std std-doc">warp-pipe</span></a></p></li>
<li><p><a class="reference internal" href="#memory-mock">memory-mock</a></p></li>
<li><p><a class="reference internal" href="twister.html#zephyr-setup"><span class="std std-ref">Zephyr</span></a></p></li>
</ul>
<p>The PCIe DMA sample is available in <code class="docutils literal notranslate"><span class="pre">zephyr-samples/pcie_dma</span></code>.</p>
<p>This sample uses a modified <a class="reference external" href="https://github.com/antmicro/warp-pipe/blob/main/zephyr-samples/drivers/dma/dma_emul.c"><code class="docutils literal notranslate"><span class="pre">dma_emul</span></code></a> driver to perform DMA transactions between Zephyr and <code class="docutils literal notranslate"><span class="pre">memory-mock</span></code>.</p>
<p>Zephyr starts by configuring the DMA transaction, setting the source to the remode memory and target to its own local space. Then it issues a transaction that copies data from <code class="docutils literal notranslate"><span class="pre">memory-mock</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">dma-emul</span></code> was adapted to use the warp-pipe API directly, so it needs to be compiled for the <code class="docutils literal notranslate"><span class="pre">native_sim</span></code> target.</p>
<p>First, build the sample:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><code><span class="n">west</span> <span class="n">build</span> <span class="o">-</span><span class="n">p</span> <span class="o">-</span><span class="n">d</span> <span class="n">build</span><span class="o">.</span><span class="n">pcie_dma</span> <span class="o">-</span><span class="n">b</span> <span class="n">native_sim</span> <span class="n">zephyr</span><span class="o">-</span><span class="n">samples</span><span class="o">/</span><span class="n">pcie_dma</span><span class="o">/</span>
</code></pre></div>
</div>
<p>Then start the <code class="docutils literal notranslate"><span class="pre">memory-mock</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><code><span class="o">./</span><span class="n">build_memory_mock</span><span class="o">/</span><span class="n">memory_mock</span>
</code></pre></div>
</div>
<p>Lastly, run Zephyr:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><code><span class="o">./</span><span class="n">build</span><span class="o">.</span><span class="n">pcie_dma</span><span class="o">/</span><span class="n">zephyr</span><span class="o">/</span><span class="n">zephyr</span><span class="o">.</span><span class="n">exe</span>
</code></pre></div>
</div>
<p>Expect the following output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><code><span class="n">Data</span> <span class="n">transfer</span> <span class="n">finished</span><span class="p">:</span> <span class="mh">0x10</span> <span class="mh">0x11</span> <span class="mh">0x12</span> <span class="mh">0x13</span> <span class="mh">0x14</span> <span class="mh">0x15</span> <span class="mh">0x16</span> <span class="mh">0x17</span> <span class="mh">0x18</span> <span class="mh">0x19</span> <span class="mh">0x1a</span> <span class="mh">0x1b</span> <span class="mh">0x1c</span> <span class="mh">0x1d</span> <span class="mh">0x1e</span> <span class="mh">0x1f</span> <span class="mh">0x20</span> <span class="mh">0x21</span> <span class="mh">0x22</span> <span class="mh">0x23</span> <span class="mh">0x24</span> <span class="mh">0x25</span> <span class="mh">0x26</span> <span class="mh">0x27</span> <span class="mh">0x28</span> <span class="mh">0x29</span> <span class="mh">0x2a</span> <span class="mh">0x2b</span> <span class="mh">0x2c</span> <span class="mh">0x2d</span> <span class="mh">0x2e</span> <span class="mh">0x2f</span>
</code></pre></div>
</div>


  <hr>
<div class="md-source-file">
  <small>
    
      Last update:
      2024-09-09
    
  </small>
</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="basics.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: Basic Warp Pipe usage" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Basic Warp Pipe usage
            </div>
          </div>
        </a>
      
      
        
        <a href="library.html" class="md-footer__link md-footer__link--next" aria-label="Next: Using the library" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Using the library
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  
  
  <div class="md-footer-meta md-typeset">
    
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-footer-copyright__highlight">
        Copyright &#169; Antmicro, Meta, 2024.
        
    </div>
  
  
</div>
      
        <div class="md-social">
  
    
    
      
      
    
    <a href="https://github.com/antmicro" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://twitter.com/antmicro" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
</div>
      
    </div>
    
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": ".", "features": ["toc.integrate"], "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
      
        <script src="_static/sphinx_immaterial_theme.1b5b7a2d5891aec19.min.js?v=1e7b0789"></script>
    
  </body>
</html>